<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Brawl Stars ¬∑ –¥–≤–∞ –¥–∂–æ–π—Å—Ç–∏–∫–∞ (Mobile)</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: none; /* –∑–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É/–º–∞—Å—à—Ç–∞–± –≤–Ω—É—Ç—Ä–∏ –∫–∞–Ω–≤–∞—Å–∞ */
        }
        body {
            margin: 0;
            min-height: 100vh;
            background: #1a2a32;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            touch-action: pan-y; /* –æ–±—â–∏–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
        }
        .game-container {
            width: 100%;
            max-width: 450px;
            aspect-ratio: 9 / 16;
            background: #2a3f4a;
            border-radius: 36px;
            box-shadow: 0 20px 30px rgba(0,0,0,0.6);
            position: relative;
            overflow: hidden;
            border: 4px solid #5f7f8f;
            touch-action: none;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 40%, #507080, #1e2f38);
            cursor: none; /* –Ω–∞ –º–æ–±–∏–ª–∫–µ –Ω–µ–≤–∞–∂–Ω–æ */
        }
        /* –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã) */
        .label-left, .label-right {
            position: absolute;
            bottom: 16px;
            left: 24px;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: rgba(0,0,0,0.3);
            padding: 4px 10px;
            border-radius: 30px;
            backdrop-filter: blur(2px);
            pointer-events: none;
        }
        .label-right {
            left: auto;
            right: 24px;
        }
        .joystick-indicator {
            position: absolute;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 10px;
            opacity: 0.2;
            pointer-events: none;
        }
    </style>
</head>
<body>
<div class="game-container" id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <!-- –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∏, –ø—Ä–æ—Å—Ç–æ –¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞ -->
    <div class="label-left">‚¨ÜÔ∏è –î–í–ò–ñ–ï–ù–ò–ï</div>
    <div class="label-right">üî´ –°–¢–†–ï–õ–¨–ë–ê</div>
</div>

<script>
    (function() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // –†–∞–∑–º–µ—Ä—ã –∫–∞–Ω–≤–∞—Å–∞ (–±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–æ –ø–æ–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
        let canvasWidth, canvasHeight;

        // ----- –ò–ì–†–û–ö (–∫—Ä—É–≥) -----
        const player = {
            x: 0,        // —Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ (—É—Å—Ç–∞–Ω–æ–≤–∏–º –ø–æ—Å–ª–µ —Ä–µ—Å–∞–π–∑–∞)
            y: 0,
            r: 22,       // —Ä–∞–¥–∏—É—Å
            speed: 4.2   // –ø–∏–∫—Å–µ–ª–µ–π –∑–∞ –∫–∞–¥—Ä (–ø–æ–¥ 60fps)
        };

        // ----- –î–ñ–û–ô–°–¢–ò–ö–ò -----
        // –õ–µ–≤—ã–π (—Å–∏–Ω–∏–π) ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
        const leftStick = {
            active: false,
            id: 'left',
            startX: 0, startY: 0,    // –ø–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞ –∑–æ–Ω—ã (—Ñ–∏–∫—Å. –Ω–∏–∑ —Å–ª–µ–≤–∞)
            currentX: 0, currentY: 0, // —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä—É—á–∫–∏ (–¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏)
            dirX: 0, dirY: 0,         // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (-1 .. 1)
            maxDist: 60,              // —Ä–∞–¥–∏—É—Å –º—ë—Ä—Ç–≤–æ–π –∑–æ–Ω—ã/–º–∞–∫—Å —Å–º–µ—â–µ–Ω–∏—è —Ä—É—á–∫–∏
            baseR: 40,                // —Ä–∞–¥–∏—É—Å –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã
            handleR: 22,              // —Ä–∞–¥–∏—É—Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä—É—á–∫–∏
            touchId: null             // –¥–ª—è –º—É–ª—å—Ç–∏—Ç–∞—á –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        };

        // –ü—Ä–∞–≤—ã–π (–∫—Ä–∞—Å–Ω—ã–π) ‚Äî —Å—Ç—Ä–µ–ª—å–±–∞
        const rightStick = {
            active: false,
            id: 'right',
            startX: 0, startY: 0,
            currentX: 0, currentY: 0,
            dirX: 0, dirY: 0,
            maxDist: 60,
            baseR: 40,
            handleR: 22,
            touchId: null
        };

        // ----- –ú–ê–°–°–ò–í –ü–£–õ–¨ -----
        let bullets = [];
        const BULLET_SPEED = 5.6;
        const BULLET_RADIUS = 8;
        const MAX_BULLETS = 50;          // –æ–≥—Ä–∞–Ω–∏—á–∏–º, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –ø–∞–º—è—Ç—å
        const FIRE_COOLDOWN_FRAMES = 12;  // –ø—Ä–∏–º–µ—Ä–Ω–æ 5 –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –≤ —Å–µ–∫ –ø—Ä–∏ 60fps
        let fireCooldown = 0;

        // ----- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –†–ê–ó–ú–ï–†–û–í –ò –ü–û–ó–ò–¶–ò–ô -----
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            // –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            canvasWidth = canvas.width;
            canvasHeight = canvas.height;

            // –∏–≥—Ä–æ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É
            player.x = canvasWidth / 2;
            player.y = canvasHeight / 2;

            // —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–∂–æ–π—Å—Ç–∏–∫–æ–≤ (–Ω–∏–∂–Ω–∏–µ —É–≥–ª—ã —Å –æ—Ç—Å—Ç—É–ø–æ–º)
            leftStick.startX = 90;
            leftStick.startY = canvasHeight - 90;
            // –Ω–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä—É—á–∫–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –±–∞–∑–æ–π
            leftStick.currentX = leftStick.startX;
            leftStick.currentY = leftStick.startY;

            rightStick.startX = canvasWidth - 90;
            rightStick.startY = canvasHeight - 90;
            rightStick.currentX = rightStick.startX;
            rightStick.currentY = rightStick.startY;
        }

        // ----- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ê–°–ê–ù–ò–ô (–º—É–ª—å—Ç–∏—Ç–∞—á) -----
        function handleTouchStart(e) {
            e.preventDefault();
            const touches = e.touches;

            for (let i = 0; i < touches.length; i++) {
                const touch = touches[i];
                const touchId = touch.identifier;
                const touchX = touch.clientX - canvas.getBoundingClientRect().left;
                const touchY = touch.clientY - canvas.getBoundingClientRect().top;

                // –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —É–∂–µ –∫–∞—Å–∞–Ω–∏–µ –∫–∞–∫–æ–º—É-—Ç–æ —Å—Ç–∏–∫—É (–ø–æ touchId)
                if (leftStick.touchId === null && rightStick.touchId === null) {
                    // —Å–≤–æ–±–æ–¥–Ω—ã –æ–±–∞ ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏: –ª–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ -> –ª–µ–≤—ã–π —Å—Ç–∏–∫
                    if (touchX < canvasWidth / 2) {
                        // –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ª–µ–≤—ã–π —Å—Ç–∏–∫
                        leftStick.active = true;
                        leftStick.touchId = touchId;
                        updateStickFromTouch(leftStick, touchX, touchY);
                    } else {
                        // –ø—Ä–∞–≤—ã–π
                        rightStick.active = true;
                        rightStick.touchId = touchId;
                        updateStickFromTouch(rightStick, touchX, touchY);
                    }
                } 
                else if (leftStick.touchId === null && !leftStick.active) {
                    // –µ—Å–ª–∏ –ª–µ–≤—ã–π —Å–≤–æ–±–æ–¥–µ–Ω, –Ω–æ –ø—Ä–∞–≤—ã–π –∑–∞–Ω—è—Ç? –ø—Ä–æ–≤–µ—Ä–∏–º, –º–æ–∂–µ—Ç –∫–æ—Å–Ω—É–ª–∏—Å—å –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    if (touchX < canvasWidth / 2) {
                        leftStick.active = true;
                        leftStick.touchId = touchId;
                        updateStickFromTouch(leftStick, touchX, touchY);
                    } else {
                        // –∞ –µ—Å–ª–∏ –ø—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞, –Ω–æ –ø—Ä–∞–≤—ã–π —É–∂–µ –∑–∞–Ω—è—Ç? –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º (–Ω–µ –Ω–∞–∑–Ω–∞—á–∞–µ–º –¥–≤–∞ –Ω–∞ –æ–¥–∏–Ω —Å—Ç–∏–∫)
                        // –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? –æ—Å—Ç–∞–≤–∏–º —Ç–∞–∫: –Ω–µ –Ω–∞–∑–Ω–∞—á–∞–µ–º.
                    }
                }
                else if (rightStick.touchId === null && !rightStick.active) {
                    if (touchX >= canvasWidth / 2) {
                        rightStick.active = true;
                        rightStick.touchId = touchId;
                        updateStickFromTouch(rightStick, touchX, touchY);
                    }
                }
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touches = e.touches;

            for (let i = 0; i < touches.length; i++) {
                const touch = touches[i];
                const touchId = touch.identifier;
                const touchX = touch.clientX - canvas.getBoundingClientRect().left;
                const touchY = touch.clientY - canvas.getBoundingClientRect().top;

                // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–µ–≤—ã–π —Å—Ç–∏–∫ –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                if (leftStick.active && leftStick.touchId === touchId) {
                    updateStickFromTouch(leftStick, touchX, touchY);
                }
                // –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∞–≤—ã–π —Å—Ç–∏–∫
                if (rightStick.active && rightStick.touchId === touchId) {
                    updateStickFromTouch(rightStick, touchX, touchY);
                }
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            const touches = e.touches; // –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Å–∞–Ω–∏—è
            const touchIds = new Set();
            for (let i = 0; i < touches.length; i++) {
                touchIds.add(touches[i].identifier);
            }

            // –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ç–∏–∫–∏, —á–µ–π touchId –±–æ–ª—å—à–µ –Ω–µ –≤ –Ω–∞–±–æ—Ä–µ
            if (leftStick.touchId !== null && !touchIds.has(leftStick.touchId)) {
                resetStick(leftStick);
            }
            if (rightStick.touchId !== null && !touchIds.has(rightStick.touchId)) {
                resetStick(rightStick);
            }

            // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —Å—Ç–∏–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∏–∑-–∑–∞ –±–∞–≥–æ–≤, –Ω–æ –Ω–µ—Ç –∫–∞—Å–∞–Ω–∏–π –≤–æ–æ–±—â–µ
            if (touches.length === 0) {
                if (leftStick.active) resetStick(leftStick);
                if (rightStick.active) resetStick(rightStick);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∏–∫–æ–≤
        function updateStickFromTouch(stick, touchX, touchY) {
            // –≤—ã—á–∏—Å–ª—è–µ–º –≤–µ–∫—Ç–æ—Ä –æ—Ç –±–∞–∑—ã –¥–æ –∫–∞—Å–∞–Ω–∏—è
            let dx = touchX - stick.startX;
            let dy = touchY - stick.startY;
            const distance = Math.sqrt(dx*dx + dy*dy);

            // –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ä–∞–¥–∏—É—Å–æ–º maxDist
            if (distance > stick.maxDist) {
                dx = (dx / distance) * stick.maxDist;
                dy = (dy / distance) * stick.maxDist;
            }

            stick.currentX = stick.startX + dx;
            stick.currentY = stick.startY + dy;

            // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ distance > 0, –∏–Ω–∞—á–µ (0,0))
            if (distance > 1) {
                stick.dirX = dx / stick.maxDist;
                stick.dirY = dy / stick.maxDist;
            } else {
                stick.dirX = 0;
                stick.dirY = 0;
            }
        }

        function resetStick(stick) {
            stick.active = false;
            stick.touchId = null;
            stick.currentX = stick.startX;
            stick.currentY = stick.startY;
            stick.dirX = 0;
            stick.dirY = 0;
        }

        // ----- –°–¢–†–ï–õ–¨–ë–ê (–Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–æ–≥–æ –¥–∂–æ–π—Å—Ç–∏–∫–∞) -----
        function shootFromRightStick() {
            if (!rightStick.active) return;            // —Å—Ç–∏–∫ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
            if (rightStick.dirX === 0 && rightStick.dirY === 0) return; // –Ω–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

            // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä —É–∂–µ –µ—Å—Ç—å (dirX, dirY) ‚Äî –æ–Ω —É–∂–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö -1..1
            // –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–æ–π –º–µ–Ω—å—à–µ 1, –µ—Å–ª–∏ —Å–º–µ—â–µ–Ω–∏–µ –Ω–µ –Ω–∞ –ø–æ–ª–Ω—É—é. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å (—Å–∫–æ—Ä–æ—Å—Ç—å –ø—É–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞)
            let norm = Math.hypot(rightStick.dirX, rightStick.dirY);
            if (norm < 0.15) return; // –º—ë—Ä—Ç–≤–∞—è –∑–æ–Ω–∞, —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ

            // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞
            const dirX = rightStick.dirX / norm;
            const dirY = rightStick.dirY / norm;

            bullets.push({
                x: player.x,
                y: player.y,
                vx: dirX * BULLET_SPEED,
                vy: dirY * BULLET_SPEED,
                r: BULLET_RADIUS,
                life: true
            });

            // –æ–≥—Ä–∞–Ω–∏—á–∏–º –º–∞—Å—Å–∏–≤ (—É–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ, –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ)
            if (bullets.length > MAX_BULLETS) {
                bullets.splice(0, bullets.length - MAX_BULLETS);
            }
        }

        // ----- –û–ë–ù–û–í–õ–ï–ù–ò–ï –õ–û–ì–ò–ö–ò -----
        function update() {
            // 1. –¥–≤–∏–≥–∞–µ–º –∏–≥—Ä–æ–∫–∞ –ø–æ –ª–µ–≤–æ–º—É —Å—Ç–∏–∫—É
            if (leftStick.active) {
                const moveX = leftStick.dirX * player.speed;
                const moveY = leftStick.dirY * player.speed;
                // –æ–≥—Ä–∞–Ω–∏—á–∏–º, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –Ω–µ —É—Ö–æ–¥–∏–ª –∑–∞ –∫—Ä–∞—è (—Å —É—á—ë—Ç–æ–º —Ä–∞–¥–∏—É—Å–∞)
                let newX = player.x + moveX;
                let newY = player.y + moveY;
                newX = Math.min(Math.max(newX, player.r), canvasWidth - player.r);
                newY = Math.min(Math.max(newY, player.r), canvasHeight - player.r);
                player.x = newX;
                player.y = newY;
            }

            // 2. —Å—Ç—Ä–µ–ª—å–±–∞ (—Å –∫—É–ª–¥–∞—É–Ω–æ–º)
            if (fireCooldown <= 0) {
                if (rightStick.active) {
                    shootFromRightStick();
                    fireCooldown = FIRE_COOLDOWN_FRAMES;
                }
            } else {
                fireCooldown--;
            }

            // 3. –¥–≤–∏–≥–∞–µ–º –ø—É–ª–∏ –∏ —É–¥–∞–ª—è–µ–º –≤—ã—à–µ–¥—à–∏–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
            for (let i = bullets.length - 1; i >= 0; i--) {
                const b = bullets[i];
                b.x += b.vx;
                b.y += b.vy;

                // –µ—Å–ª–∏ –ø—É–ª—è —Å–æ–≤—Å–µ–º —É–ª–µ—Ç–µ–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (—Å –∑–∞–ø–∞—Å–æ–º)
                if (b.x + b.r < 0 || b.x - b.r > canvasWidth || b.y + b.r < 0 || b.y - b.r > canvasHeight) {
                    bullets.splice(i, 1);
                }
            }
        }

        // ----- –û–¢–†–ò–°–û–í–ö–ê -----
        function draw() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // ---- –∏–≥—Ä–æ–∫ (–∫—Ä—É–≥) ----
            ctx.shadowColor = '#ffffff60';
            ctx.shadowBlur = 20;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
            ctx.fillStyle = '#F5D742'; // –∑–æ–ª–æ—Ç–∏—Å—Ç—ã–π
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.shadowColor = 'transparent';
            // –∫–æ–Ω—Ç—É—Ä
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2.5;
            ctx.stroke();

            // ---- –ª–µ–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ (—Å–∏–Ω–∏–π) ----
            ctx.globalAlpha = 0.65;
            // –±–∞–∑–∞
            ctx.beginPath();
            ctx.arc(leftStick.startX, leftStick.startY, leftStick.baseR, 0, Math.PI*2);
            ctx.fillStyle = '#2277ff';
            ctx.fill();
            ctx.strokeStyle = '#ffffff80';
            ctx.lineWidth = 2;
            ctx.stroke();
            // —Ä—É—á–∫–∞ (—Å–º–µ—â–∞–µ–º–∞—è)
            ctx.shadowBlur = 14;
            ctx.shadowColor = '#00000060';
            ctx.beginPath();
            ctx.arc(leftStick.currentX, leftStick.currentY, leftStick.handleR, 0, Math.PI*2);
            ctx.fillStyle = '#88ccff';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();

            // ---- –ø—Ä–∞–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ (–∫—Ä–∞—Å–Ω—ã–π) ----
            ctx.beginPath();
            ctx.arc(rightStick.startX, rightStick.startY, rightStick.baseR, 0, Math.PI*2);
            ctx.fillStyle = '#cc3333';
            ctx.fill();
            ctx.strokeStyle = '#ffffff80';
            ctx.stroke();
            // —Ä—É—á–∫–∞
            ctx.beginPath();
            ctx.arc(rightStick.currentX, rightStick.currentY, rightStick.handleR, 0, Math.PI*2);
            ctx.fillStyle = '#ff8888';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.stroke();

            ctx.shadowBlur = 0;
            ctx.globalAlpha = 1.0;

            // ---- –ø—É–ª–∏ (–∫—Ä–∞—Å–Ω—ã–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞—Ä–∏–∫–∏) ----
            for (let b of bullets) {
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.r, 0, 2 * Math.PI);
                ctx.fillStyle = '#FF5555';
                ctx.shadowBlur = 16;
                ctx.shadowColor = '#ffaaaa';
                ctx.fill();
                // –Ω–µ–±–æ–ª—å—à–æ–π –±–ª–∏–∫
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#FFEE88';
                ctx.beginPath();
                ctx.arc(b.x-2, b.y-2, 3, 0, 2*Math.PI);
                ctx.fill();
            }
            ctx.shadowBlur = 0;
            ctx.shadowColor = 'transparent';
        }

        // –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ----- –ü–û–î–ü–ò–°–ö–ê –ù–ê –°–û–ë–´–¢–ò–Ø (–º–æ–±–∏–ª—å–Ω—ã–µ touch) -----
        function attachEvents() {
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
            canvas.addEventListener('touchcancel', handleTouchEnd, { passive: false });
            // –º—ã—à—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ (–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–µ ‚Äî —Ç–∞—á)
            // –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º—ã—à—å, –Ω–æ –∑–¥–µ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏–º —á–∏—Å—Ç–æ—Ç—É
        }

        // ----- –°–¢–ê–†–¢ -----
        function init() {
            resizeCanvas();
            attachEvents();
            gameLoop();
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            // –ø–æ—Å–ª–µ —Ä–µ—Å–∞–π–∑–∞ –Ω–∞–¥–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç–∏–∫–æ–≤ (–æ–Ω–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –≤–Ω—É—Ç—Ä–∏ resizeCanvas)
            // –Ω–æ –µ—Å–ª–∏ —Å—Ç–∏–∫–∏ –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã, –æ–Ω–∏ –ø–æ–ª—É—á–∞—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —Å–±—Ä–æ—Å–∏–º –∏—Ö.
            resetStick(leftStick);
            resetStick(rightStick);
        });

        init();
    })();
</script>
</body>
</html>